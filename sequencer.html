

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=no">
  <title>Animal v1</title>



  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,200;0,400;0,600;0,900;1,200;1,400;1,600;1,900&display=swap"
    rel="stylesheet">


  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
    integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">


  <link rel="stylesheet" href="GUI/style.css">
  <!--<script src="/tone/Tone.js"></script>-->
  <script type="module">
    import * as Tone from "/tone/Tone.js";
  </script>
  <style>
    .ajeno {
      pointer-events: none;
    }
  </style>

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-167506651-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'UA-167506651-1');
  </script>


</head>

<body>
  <!-- ALERTA start

   <div id="alerta" class="fondo-aqua-animal" style="display:none">
     <div class="container">
       <div class="col-12 pt-5 text-center">
         <h1 class="mt-5">¡Opa!</h1>
         <h3 class="mt-1">Animal funciona en modo horizontal.<br />
           ¡Porfavor rota tu dispositivo! y regresa al <a href="https://mom-lab.xyz/" >inicio</a></h3>
         <div class="w-25 mx-auto mt-3">
           <img src="/GUI/img/rotate-devise.png" class="img-fluid">
         </div>
       </div>
     </div>
   </div>

 ALERTA end -->

 <!-- MODALS -->

   <!-- PLAY Modal -->
   <div class="modal fade" id="playModal" tabindex="-1" role="dialog" aria-labelledby="settingsModalLabel"
     aria-hidden="true">
     <div class="modal-dialog" role="document">
       <div class="modal-content">
         <div class="modal-header fondo-aqua-animal">
           <button type="button" class="close" data-dismiss="modal" aria-label="Close">
             <span aria-hidden="true">&times;</span>
           </button>
         </div>
         <!-- MODAL BODY -->
         <div class="modal-body fondo-aqua-animal">
           <div class="row mb-5">
             <div class="col-12 text-center">
               <div id="Animal_logo" class="mx-auto">
                 <img src="GUI/img/Animal_logo_v0.png" width="300px">
               </div>
               <h1 class="my-5">Welcome!</h1>
                 <h3 >
                   Click outside this window to close it.
                 </h3>
               <div class="row">
                 <div class="col-6">
                   <h3 class="mt-1">
                     Press the SETTINGS button to change the sounds.
                   </h3>
                   <div class="w-50 mx-auto mt-3">
                     <img src="GUI/svg/push-settings-gris.svg" class="img-fluid">
                   </div>
                 </div>
                 <div class="col-6">
                   <h3 class="mt-1">
                     Activate the <span translate="no">Jam</span> session to invite more musical explorers.
                   </h3>
                   <div class="w-50 mx-auto mt-3">
                     <img src="GUI/svg/push-jam.svg" class="img-fluid">
                   </div>
                 </div>
               </div>

             </div>
           </div>
         </div>
         <!-- modal body end -->
       </div>
     </div>
   </div>
   <!-- PLAY modal end -->

   <!-- JAM Modal -->

   <div class="modal fade" id="jamModal" tabindex="-1" role="dialog" aria-labelledby="jamModalLabel" aria-hidden="true">
     <div class="modal-dialog" role="document">
       <div class="modal-content">
         <div class="modal-header">
           <button type="button" class="close" data-dismiss="modal" aria-label="Close">
             <span aria-hidden="true">&times;</span>
           </button>
           <h4 class="modal-title" id="jamModalLabel"><span translate="no">Jam</span></h4>
         </div>

         <!-- MODAL BODY -->

         <div class="modal-body px-3 pt-0 pb-3">

           <div class="mb-1">
             Choose your instruments
           </div>
           <div id="sel-inst" class="row mb-1">

             <div class="col-3 my-1">
               <div class="corners-2 fondo-1-animal p-2 channelsInvite" sel="false" channelNumber="1"
                 id="channelsInvite1">
                 <div class="d-flex justify-content-around">

                   <div class="audio-preview-s">
                     <img id="instrument-preview1" src="GUI/img/audio_trans.png"
                       class="audio-preview-s instrument-preview ">
                   </div>



                   <div id="sel-ch8" class="icon-container-s ml-1">
                     <object type="image/svg+xml" data="GUI/svg/iconos/cerdo-w.svg" class="animal-icon-s">
                       Pig
                     </object>
                   </div>

                 </div>
                 <div class="titulo text-center pt-1">Pig</div>
               </div>
             </div>

             <div class="col-3 my-1">
               <div class="corners-2 fondo-1-animal p-2 channelsInvite" sel="false" channelNumber="2"
                 id="channelsInvite2">
                 <div class="d-flex justify-content-around">

                   <div class="audio-preview-s">
                     <img id="instrument-preview2" src="GUI/img/audio_trans.png"
                       class="audio-preview-s instrument-preview ">
                   </div>

                   <div id="sel-ch7" class="icon-container-s ml-1">
                     <object type="image/svg+xml" data="GUI/svg/iconos/loro-w.svg" class="animal-icon-s">
                       Bird
                     </object>
                   </div>

                 </div>
                 <div class="titulo text-center pt-1">Bird</div>
               </div>
             </div>

             <div class="col-3 my-1">
               <div class="corners-2 fondo-1-animal p-2 channelsInvite" sel="false" channelNumber="3"
                 id="channelsInvite3">
                 <div class="d-flex justify-content-around">

                   <div class="audio-preview-s">
                     <img id="instrument-preview3" src="GUI/img/audio_trans.png"
                       class="audio-preview-s instrument-preview ">
                   </div>

                   <div id="sel-ch6" class="icon-container-s ml-1">
                     <object type="image/svg+xml" data="GUI/svg/iconos/sapo-w.svg" class="animal-icon-s">
                       Frog
                     </object>
                   </div>

                 </div>
                 <div class="titulo text-center pt-1">Frog</div>
               </div>
             </div>

             <div class="col-3 my-1">
               <div class="corners-2 fondo-1-animal p-2 channelsInvite" sel="false" channelNumber="4"
                 id="channelsInvite4">
                 <div class="d-flex justify-content-around">

                   <div class="audio-preview-s">
                     <img id="instrument-preview4" src="GUI/img/audio_trans.png"
                       class="audio-preview-s instrument-preview ">
                   </div>

                   <div id="sel-ch5" class="icon-container-s ml-1">
                     <object type="image/svg+xml" data="GUI/svg/iconos/pato-w.svg" class="animal-icon-s">
                       Duck
                     </object>
                   </div>

                 </div>
                 <div class="titulo text-center pt-1">Duck</div>
               </div>
             </div>

             <div class="col-3 my-1">
               <div class="corners-2 fondo-1-animal p-2 channelsInvite" sel="false" channelNumber="5"
                 id="channelsInvite5">
                 <div class="d-flex justify-content-around">

                   <div class="audio-preview-s">
                     <img id="instrument-preview5" src="GUI/img/audio_trans.png"
                       class="audio-preview-s instrument-preview ">
                   </div>

                   <div id="sel-ch4" class="icon-container-s ml-1">
                     <object type="image/svg+xml" data="GUI/svg/iconos/mono-w.svg" class="animal-icon-s">
                       Ape
                     </object>
                   </div>

                 </div>
                 <div class="titulo text-center pt-1">Ape</div>
               </div>
             </div>

             <div class="col-3 my-1">
               <div class="corners-2 fondo-1-animal p-2 channelsInvite" sel="false" channelNumber="6"
                 id="channelsInvite6">
                 <div class="d-flex justify-content-around">

                   <div class="audio-preview-s">
                     <img id="instrument-preview6" src="GUI/img/audio_trans.png"
                       class="audio-preview-s instrument-preview ">
                   </div>

                   <div id="sel-ch3" class="icon-container-s ml-1">
                     <object type="image/svg+xml" data="GUI/svg/iconos/gato-w.svg" class="animal-icon-s">
                       Cat
                     </object>
                   </div>

                 </div>
                 <div class="titulo text-center pt-1">Cat</div>
               </div>
             </div>

             <div class="col-3 my-1">
               <div class="corners-2 fondo-1-animal p-2 channelsInvite" sel="false" channelNumber="7"
                 id="channelsInvite7">
                 <div class="d-flex justify-content-around">

                   <div class="audio-preview-s">
                     <img id="instrument-preview7" src="GUI/img/audio_trans.png"
                       class="audio-preview-s instrument-preview ">
                   </div>

                   <div id="sel-ch2" class="icon-container-s ml-1">
                     <object type="image/svg+xml" data="GUI/svg/iconos/oso-w.svg" class="animal-icon-s">
                       Bear
                     </object>
                   </div>

                 </div>
                 <div class="titulo text-center pt-1">Bear</div>
               </div>
             </div>

             <div class="col-3 my-1">
               <div class="corners-2 fondo-1-animal p-2 channelsInvite" sel="false" channelNumber="8"
                 id="channelsInvite8">
                 <div class="d-flex justify-content-around">

                   <div class="audio-preview-s">
                     <img id="instrument-preview8" src="GUI/img/audio_trans.png"
                       class="audio-preview-s instrument-preview  ">
                   </div>

                   <div id="sel-ch1" class="icon-container-s ml-1">
                     <object type="image/svg+xml" data="GUI/svg/iconos/buho-w.svg" class="animal-icon-s">
                       Owl
                     </object>
                   </div>

                 </div>
                 <div class="titulo text-center pt-1">Owl</div>
               </div>
             </div>

           </div>
           <!-- <input type="button" value="ok" id="okCanales"> -->
           <div class="mb-1">
             <button type="button" value="ok" id="okCanales" class="btn btn-secondary px-4">
               <span translate="no">Ok</span>
             </button>
           </div>

           <div class="mt-3">
             Invite music explorers
           </div>

           <div id="enlace">
             <div class="input-group mb-3">
               <input type="text" class="form-control" placeholder="session link" id="linkText" aria-label="sesion"
                 aria-describedby="basic-addon2">
               <div class="input-group-append">
                 <button class="btn btn-outline-secondary" type="button"><span translate="no">Copy</span></button>
               </div>
             </div>
           </div>

           <!-- modal body end -->

         </div>
         <div class="modal-footer">
         </div>
       </div>
     </div>
   </div>

   <!-- jam modal end -->

   <!-- HELP Modal -->

   <div class="modal fade" id="helpModal" tabindex="-1" role="dialog" aria-labelledby="helpModalLabel"
     aria-hidden="true">
     <div class="modal-dialog" role="document">
       <div class="modal-content">
         <div class="modal-header">
           <h5 class="modal-title" id="helpModalLabel">Help</h5>
           <button type="button" class="close" data-dismiss="modal" aria-label="Close">
             <span aria-hidden="true">&times;</span>
           </button>
         </div>

         <!-- MODAL BODY -->

         <div class="modal-body">
           ...
         </div>

         <!-- modal body end -->

         <div class="modal-footer">
         </div>
       </div>
     </div>
   </div>

   <!-- help modal end -->

 <!-- LORO REC Modal -->

   <div class="modal fade" id="lororecModal" tabindex="-1" role="dialog" aria-labelledby="settingsModalLabel"
     aria-hidden="true">
     <div class="modal-dialog modal-sm" role="document">
       <div class="modal-content">
         <div class="modal-header">
           <button type="button" class="close" data-dismiss="modal" aria-label="Close">
             <span aria-hidden="true">&times;</span>
           </button>
           <h4 class="modal-title" id="settingsModalLabel">Rec sample</h4>
         </div>
         <!-- MODAL BODY -->
         <div class="modal-body px-3 pt-0 pb-3">

           <div class="row">
             <div id="rec-play" class="col">
               <div class="mb-1">
                 Puedes grabar un sonido de hasta 3 segundos.
               </div>
               <div class="btn-group my-2" role="group" aria-label="Basic example">
                 <div id="loro-rec-preview" class="audio-preview corners-l">
                   <img src="GUI/img/audio-trans.png" class="animal-pointer corners-l h-100 w-auto" data-toggle="tooltip"
                     data-placement="top" title="Escuchar">
                 </div>
                 <div id="loro-rec-button" class="d-flex align-items-center loro-rec corners-r">

                   <a href="#" id="recDuration" class="d-flex m-auto texto-chico rec-icon-s">Rec</a>
                 </div>
                 <span id="duration"></span>
               </div>
               <div class="mb-1">
                 Haz click en el parlante para escuchar, click en OK para usar el sonido.
               </div>

               <div class="mb-1">
                 <button type="button" id="ok-rec-loro" class="btn btn-secondary px-4">
                   Ok
                 </button>
               </div>
             </div>
           </div>

         </div>
         <!-- modal body end -->
         <div class="modal-footer">
         </div>
       </div>
     </div>
   </div>

 <!-- loro rec end -->

 <!-- SETTINGS Modal -->

   <div class="modal fade" id="settingsModal" tabindex="-1" role="dialog" aria-labelledby="settingsModalLabel"
     aria-hidden="true">
     <div class="modal-dialog" role="document">
       <div class="modal-content">
         <div class="modal-header">
           <button type="button" class="close" data-dismiss="modal" aria-label="Close">
             <span aria-hidden="true">&times;</span>
           </button>
           <h4 class="modal-title" id="settingsModalLabel">Settings</h4>

         </div>

         <!-- MODAL BODY -->

         <div class="modal-body px-3 pt-0 pb-3">
           <div class="row">
             <!-- <div class="col-12">Fondos</div>
             <div class="col-12 m-0 d-flex">
               <div class="color-chip-1 mr-3"></div>
               <div class="color-chip-2 mr-3"></div>
               <div class="color-chip-3 mr-3"></div>
               <div class="color-chip-4 mr-3"></div>
               <div class="color-chip-5 mr-3"></div>
             </div> -->

            <!-- Sound kits -->

             <div class="col-12 mt-3">Sound kits</div>
             <div class="row m-0">
               <div id="sonidos-kit-1" class="col-6">
                 <div class="btn-group my-2" role="group" aria-label="Basic example">
                   <div class="audio-preview corners-l audio-pre-kit" id="audiopre-kit1">
                     <h1 class="set-num">1</h1>
                     <img id="kit-preview1" src="GUI/img/audio_trans.png"
                     class="d-none audio-preview-s kit-preview ">
                   </div>
                   <button type="button" id="kit1" class="pl-1 btn btn-secondary kits">Mano</button>
                 </div>
               </div>
               <div id="sonidos-kit-2" class="col-6">
                 <div class="btn-group my-2" role="group" aria-label="Basic example">
                   <div class="audio-preview corners-l audio-pre-kit" id="audiopre-kit2">
                     <h1 class="set-num">2</h1>
                     <img id="kit-preview2" src="GUI/img/audio_trans.png"
                     class="d-none audio-preview-s kit-preview ">
                   </div>
                   <button type="button" id="kit2" class="pl-1 btn btn-secondary kits">Animal</button>
                 </div>
               </div>
               <div id="sonidos-kit-3" class="col-6">
                 <div class="btn-group my-2" role="group" aria-label="Basic example">
                   <div class="audio-preview corners-l audio-pre-kit" id="audiopre-kit3">
                     <h1 class="set-num">3</h1>
                     <img id="kit-preview3" src="GUI/img/audio_trans.png"
                     class="d-none audio-preview-s kit-preview ">
                   </div>
                   <button type="button" id="kit3" class="pl-1 btn btn-secondary kits">Plátano</button>
                 </div>
               </div>
               <div id="sonidos-kit-4" class="col-6">
                 <div class="btn-group my-2" role="group" aria-label="Basic example">
                   <div class="audio-preview corners-l audio-pre-kit" id="audiopre-kit4">
                     <h1 class="set-num">4</h1>
                     <img id="kit-preview4" src="GUI/img/audio_trans.png"
                       class="d-none audio-preview-s kit-preview ">
                   </div>
                   <button type="button" id="kit4" class="pl-1 btn btn-secondary kits">Amazonia</button>
                 </div>
               </div>
               <div id="sonidos-kit-5" class="col-6">
                 <div class="btn-group my-2" role="group" aria-label="Basic example">
                   <div class="audio-preview corners-l audio-pre-kit" id="audiopre-kit5">
                   <h1 class="set-num">5</h1>
                   <img id="kit-preview5" src="GUI/img/audio_trans.png"
                   class="d-none audio-preview-s kit-preview ">
                   </div>
                   <button type="button" id="kit5" class="pl-1 btn btn-secondary kits">Mágico</button>
                 </div>
               </div>
               <div id="sonidos-kit-6" class="col-6">
                 <div class="btn-group my-2" role="group" aria-label="Basic example">
                   <div class="audio-preview corners-l audio-pre-kit" id="audiopre-kit6">
                     <h1 class="set-num">6</h1>
                     <img id="kit-preview6" src="GUI/img/audio_trans.png"
                     class="d-none audio-preview-s kit-preview ">
                   </div>
                   <button type="button" id="kit6" class="pl-1 btn btn-secondary kits">Safari</button>
                 </div>
               </div>
               <div id="sonidos-kit-7" class="col-6">
                 <div class="btn-group my-2" role="group" aria-label="Basic example">
                   <div class="audio-preview corners-l audio-pre-kit" id="audiopre-kit7">
                     <h1 class="set-num">7</h1>
                     <img id="kit-preview7" src="GUI/img/audio_trans.png"
                       class="d-none audio-preview-s kit-preview ">
                   </div>
                   <button type="button" id="kit7" class="pl-1 btn btn-secondary kits">Banda</button>
                 </div>
               </div>
               <div id="sonidos-kit-8" class="col-6">
                 <div class="btn-group my-2" role="group" aria-label="Basic example">
                   <div class="audio-preview corners-l audio-pre-kit" id="audiopre-kit8">
                     <h1 class="set-num">8</h1>
                     <img id="kit-preview8" src="GUI/img/audio_trans.png"
                     class="d-none audio-preview-s kit-preview ">
                   </div>
                   <button type="button" id="kit8" class="pl-1 btn btn-secondary kits">PumPum</button>
                 </div>
               </div>
               <div id="sonidos-kit-9" class="col-6">
                 <div class="btn-group my-2" role="group" aria-label="Basic example">
                   <div class="audio-preview corners-l audio-pre-kit" id="audiopre-kit9">
                     <h1 class="set-num">9</h1>
                     <img id="kit-preview9" src="GUI/img/audio_trans.png"
                     class="d-none audio-preview-s kit-preview ">
                   </div>
                   <button type="button" id="kit9" class="pl-1 btn btn-secondary kits">Bata</button>
                 </div>
               </div>

               <div id="sonidos-kit-10" class="col-6">
                 <div class="btn-group my-2" role="group" aria-label="Basic example">
                   <div class="audio-preview corners-l audio-pre-kit" id="audiopre-kit10">
                     <h1 class="set-num">10</h1>
                     <img id="kit-preview10" src="GUI/img/audio_trans.png"
                     class="d-none audio-preview-s kit-preview ">
                   </div>
                   <button type="button" id="kit10" class="pl-1 btn btn-secondary kits">aeioubmr (esp)</button>
                 </div>
               </div>
             </div>


            <!-- Sound lenght -->

             <div class="col-12 mt-3">Sound lenght</div>
             <div class="col-12 m-3 d-flex justify-content-between">
               <div id="lenght1n" class="d-flex help-item">
                 <a href="#" id="boton" class="btn btn-secondary">
                   <span translate="no">1n</span>
                 </a>
               </div>
               <div id="lenght4n" class="d-flex help-item">
                 <a href="#" id="boton" class="btn btn-secondary">
                   <span translate="no">4n</span>
                 </a>
               </div>
               <div id="lenght8n" class="d-flex help-item">
                 <a href="#" id="boton" class="btn btn-secondary">
                   <span translate="no">8n</span>
                 </a>
               </div>
               <div id="lenght16n" class="d-flex help-item">
                 <a href="#" id="boton" class="btn btn-secondary">
                   <span translate="no">16n</span>
                 </a>
               </div>
             </div>
           </div>
         </div>

         <!-- modal body end -->

         <div class="modal-footer">
         </div>
       </div>
     </div>
   </div>

 <!-- setings modal end -->

 <!-- CREDITS Modal -->

   <div class="modal fade" id="creditsModal" tabindex="-1" role="dialog" aria-labelledby="jamModalLabel" aria-hidden="true">
     <div class="modal-dialog" role="document">
       <div class="modal-content">
         <div class="modal-header">
           <button type="button" class="close" data-dismiss="modal" aria-label="Close">
             <span aria-hidden="true">&times;</span>
           </button>
           <h4 class="modal-title" id="creditsModalLabel" translate="no">Credits</h4>
           <h4 class="modal-title" translate="no">Animal v1</span>

         </div>

         <!-- MODAL BODY -->

         <div class="modal-body px-3 pt-0 pb-3">
           <b>Direction:</b></br>
           Antar Kuri</br>
           <b>Sound design:</b></br>
           Andrés Perez</br>
           <b>Programming:</b></br>
           Carolina Zunino, Antar Kuri</br>
           <b>UX/UI:</b></br>
           <span translate="no">Harto_estudio + C. Zunino</br>
           <b>Pedagogical consultancy (Uruguay)</b></br>
           Verónica Zarzabal</br>
           <b>Pedagogical consultancy (Sweden)</b></br>
           Ramiro Gonzalez</br>
           <hr>
           <span translate="no">[MoM]</span> <a href="https://mom-lab.studio/" target="_blank" translate="no" class="text-dark">mom-lab.studio</a>
         </div>
         <div class="modal-footer">
         </div>
       </div>
     </div>
   </div>

 <!-- CREDITS modal end -->

   <div class="container">

     <!-- HEADER -->

     <div id="Header" class="row">
       <div class="col-md-12 d-flex p-3 flex-row justify-content-between">
         <div id="Animal_logo" class="d-flex flex-column justify-content-arround">
           <img src="GUI/img/ANIMAL-logo-blanco.png" height="40px">
         </div>
         <div id="MoM_logo" class="d-flex mr-2 my-auto">
           <div>
             <a href="https://mom-lab.studio/" target="_blank" translate="no" class="text-dark">[MoM]</a>
           </div>
         </div>
       </div>
     </div>

     <!-- header end -->

     <!-- MAIN -->

     <div id="Main-down" class="row">
       <div id="arriba" class="col-12 mb-1">
         <div class="row" style="height: 65px;">


           <!-- BPM -->

           <div id="bpm" class="col-3 h-100 blanco-ui-animal corners1">
            <div class="row h-100">
              <div class="col-sm-12 col-md-6 p-0 d-flex">
                <div id="decrement-bpm-btn" class="w-50 d-flex my-0 animal-pointer">
                  <strong class="m-auto">-</strong>
                </div>
                <div id="increment-bpm-btn" class="w-50 d-flex my-0 animal-pointer">
                  <strong class="m-auto">+</strong>
                </div>
              </div>
              <div class="col-sm-12 col-md-6 d-flex justify-content-center" data-toggle="popover">
                <div id="bpm-display" class="numero-animal d-flex">
                  <strong id="bpmNumber" class="m-auto">90</strong>
                  <span class="m-auto pl-1 texto-chico">bpm</span>
                </div>
              </div>
            </div>
           </div>


           <!-- REC + PLAY -->
          <div id="rec-mute" class="col-3 mx-1 h-100 corners1">
            <div class="row h-100">
              <div id="rec-btn" class="col-sm-12 col-md-6 blanco-ui-animal d-flex animal-pointer">
                <span data-text="Stop" translate="no" class="m-auto">Rec</span>
              </div>
              <div id="mute-btn" class="col-sm-12 col-md-6 blanco-ui-animal d-flex animal-pointer" data-toggle="popover">
                <span data-text="Stop" translate="no" class="m-auto">Play</span>
              </div>
            </div>
          </div>

           <!--
           <div id="rec-mute" class="col-3 h-100 d-flex flex-column flex-sm-row">
             <div id="rec-btn" class="blanco-ui-animal d-flex align-items-center">
               <span class="m-auto text-center" data-text="Stop" translate="no">Rec</span>
             </div>
             <div id="mute-btn" class="blanco-ui-animal d-flex align-items-center"
               data-toggle="popover">
               <span class="m-auto text-center" data-text="Stop" translate="no">Play</span>
             </div>
           </div>
           -->


            <!-- METRONOME -->

            <div id="metronome" class="col h-100 corners1">
            </div>
         </div>


       </div>


       <div id="abajo" class="col-12">

         <div class="row mb-1">

           <!-- CHANNEL CONTROL (#ch_control) -->

           <div id="ch_control" class="col-2 my-1 my-lg-0 p-4 corners-l fondo-1-animal">
             <div class="row">
               <div class="stepper">&nbsp;</div>

               <!-- ÍCONOS y DIALES -->

               <!-- Ch1 (cerdo) -->

               <div class="col-12 p-0 d-flex flex-row justify-content-around align-items-center channelGroup" id="channelGroup1">
                 <div id="icono-ch1" class="animal-icon sound-preview" data-toggle="tooltip" data-placement="top" title="AUDIT">
                   <img src="GUI\svg\iconos\cerdo.svg" class="img-fluid animal-pointer">
                 </div>
                 <div class="d-none d-lg-block d-flex flex-column justify-content-around">
                   <div id="channel-mute1" class="channel-mute">M</div>
                   <div id="channel-solo8" class="channel-solo soloButton">S</div>
                 </div>

                 <div class="d-none d-lg-block dial_container">
                   <div id="dial-ch8" class="mom_dial" data-toggle="tooltip" data-placement="top" title="Vol."></div>
                 </div>
                 <div class="d-none d-lg-block dial_container">
                   <div id="dial-ins8" class="mom_dial" data-toggle="tooltip" data-placement="top" title="Tone"></div>
                 </div>
               </div>

               <!-- Ch2 (loro) -->

               <div class="col-12 p-0 d-flex flex-row justify-content-around align-items-center channelGroup" id="channelGroup2">
                 <div id="icono-ch2" class="animal-icon sound-preview" data-toggle="tooltip" data-placement="top" title="AUDIT">
                   <img src="GUI\svg\iconos\loro.svg" class="img-fluid animal-pointer">
                 </div>
                 <div class="d-none d-lg-block d-flex flex-column justify-content-around">
                   <div id="channel-mute2" class="channel-mute">M</div>
                   <div id="channel-solo7" class="channel-solo soloButton">S</div>
                 </div>
                 <div class="d-none d-lg-block dial_container">
                   <div id="dial-ch7" class="mom_dial" data-toggle="tooltip" data-placement="top" title="Vol."></div>
                 </div>
                 <div class="d-none d-lg-block dial_container">
                   <div id="dial-ins7" class="mom_dial" data-toggle="tooltip" data-placement="top" title="Tone"></div>
                 </div>
               </div>

               <!-- Ch3 (sapo)-->

               <div class="col-12 p-0 d-flex flex-row justify-content-around align-items-center channelGroup" id="channelGroup3">
                 <div id="icono-ch3" class="animal-icon sound-preview" data-toggle="tooltip" data-placement="top" title="AUDIT">
                   <img src="GUI\svg\iconos\sapo.svg" class="img-fluid animal-pointer">
                 </div>
                 <div class="d-none d-lg-block d-flex flex-column justify-content-around">
                   <div id="channel-mute3" class="channel-mute">M</div>
                   <div id="channel-solo6" class="channel-solo soloButton">S</div>
                 </div>
                 <div class="d-none d-lg-block dial_container">
                   <div id="dial-ch6" class="mom_dial" data-toggle="tooltip" data-placement="top" title="Vol."></div>
                 </div>
                 <div class="d-none d-lg-block dial_container">
                   <div id="dial-ins6" class="mom_dial" data-toggle="tooltip" data-placement="top" title="Tone"></div>
                 </div>
               </div>

               <!-- Ch4 (pato) -->

               <div class="col-12 p-0 d-flex flex-row justify-content-around align-items-center channelGroup" id="channelGroup4">
                 <!-- <div id="animalChannel1" class="animal-icon help-item" data-toggle="popover" title="CHANNELS"
                   data-placement="right" data-content="Activate SOLO mode by clicking on the animal iconn">
                   <img id="icono-ch5" src="GUI/img/pato.png" class="soloButton img-fluid animal-pointer"
                     data-toggle="tooltip" data-placement="top" title="SOLO">
                 </div> -->
                 <div id="icono-ch4" class="animal-icon sound-preview" data-toggle="tooltip" data-placement="top" title="AUDIT">
                   <img src="GUI\svg\iconos\pato.svg" class="img-fluid animal-pointer">
                 </div>
                 <div class="d-none d-lg-block d-flex flex-column justify-content-around">
                   <div id="channel-mute4" class="channel-mute">M</div>
                   <div id="channel-solo5" class="channel-solo soloButton">S</div>
                 </div>
                 <div class="d-none d-lg-block dial_container">
                   <div id="dial-ch5" class="mom_dial" data-toggle="tooltip" data-placement="top" title="Vol."></div>
                 </div>
                 <div class="d-none d-lg-block dial_container">
                   <div id="dial-ins5" class="mom_dial" data-toggle="tooltip" data-placement="top" title="Tone"></div>
                 </div>
               </div>

               <!-- Ch5 (mono)-->

               <div class="col-12 p-0 d-flex flex-row justify-content-around align-items-center channelGroup" id="channelGroup5">
                 <div id="icono-ch5" class="animal-icon sound-preview" data-toggle="tooltip" data-placement="top" title="AUDIT">
                   <img src="GUI\svg\iconos\mono.svg" class="img-fluid animal-pointer">
                 </div>
                 <div class="d-none d-lg-block d-flex flex-column justify-content-around">
                   <div id="channel-mute5" class="channel-mute">M</div>
                   <div id="channel-solo4" class="channel-solo soloButton">S</div>
                 </div>
                 <div class="d-none d-lg-block dial_container">
                   <div id="dial-ch4" class="mom_dial" data-toggle="tooltip" data-placement="top" title="Vol."></div>
                 </div>
                 <div class="d-none d-lg-block dial_container">
                   <div id="dial-ins4" class="mom_dial" data-toggle="tooltip" data-placement="top" title="Tone"></div>
                 </div>
               </div>

               <!-- Ch6 (gato) -->

               <div class="col-12 p-0 d-flex flex-row justify-content-around align-items-center channelGroup" id="channelGroup6">
                 <div id="icono-ch6" class="animal-icon sound-preview" data-toggle="tooltip" data-placement="top" title="AUDIT">
                   <img src="GUI\svg\iconos\gato.svg" class="img-fluid animal-pointer">
                 </div>
                 <div class="d-none d-lg-block d-flex flex-column justify-content-around">
                   <div id="channel-mute6" class="channel-mute">M</div>
                   <div id="channel-solo3" class="channel-solo soloButton">S</div>
                 </div>
                 <div class="d-none d-lg-block dial_container">
                   <div id="dial-ch3" class="mom_dial" data-toggle="tooltip" data-placement="top" title="Vol."></div>
                 </div>
                 <div class="d-none d-lg-block dial_container">
                   <div id="dial-ins3" class="mom_dial" data-toggle="tooltip" data-placement="top" title="Tone"></div>
                 </div>
               </div>

               <!-- Ch7 (oso) -->

               <div id="channelGroup7" class="col-12 p-0 d-flex flex-row justify-content-around align-items-center channelGroup" >
                 <div id="icono-ch7" class="animal-icon sound-preview" data-toggle="tooltip" data-placement="top" title="AUDIT">
                   <img src="GUI\svg\iconos\oso.svg" class="img-fluid animal-pointer">
                 </div>
                 <div class="d-none d-lg-block d-flex flex-column justify-content-around">
                   <div id="channel-mute7" class="channel-mute">M</div>
                   <div id="channel-solo2" class="channel-solo soloButton">S</div>
                 </div>
                 <div class="d-none d-lg-block dial_container">
                   <div id="dial-ch2" class="mom_dial" data-toggle="tooltip" data-placement="top" title="Vol."></div>
                 </div>
                 <div class="d-none d-lg-block dial_container">
                   <div id="dial-ins2" class="mom_dial" data-toggle="tooltip" data-placement="top" title="Tone"></div>
                 </div>
               </div>

               <!-- Ch8 (buho) -->

               <div id="channelGroup8" class="col-12 p-0 d-flex flex-row justify-content-around align-items-center channelGroup help-item"
                 data-toggle="popover" title="CHANNELS" data-placement="right"
                 data-content="Adjust the volume with the knob">
                 <div id="icono-ch8" class="animal-icon sound-preview" data-toggle="tooltip" data-placement="top" title="AUDIT">
                   <img src="GUI\svg\iconos\buho.svg" class="img-fluid animal-pointer">
                 </div>
                 <div class="d-none d-lg-block d-flex flex-column justify-content-around">
                   <div id="channel-mute8" class="channel-mute">M</div>
                   <div id="channel-solo1" class="channel-solo soloButton">S</div>
                 </div>
                 <div class="d-none d-lg-block dial_container">
                   <div id="dial-ch1" class="mom_dial" data-toggle="tooltip" data-placement="top" title="Vol."></div>
                 </div>
                 <div class="d-none d-lg-block dial_container">
                   <div id="dial-ins1" class="mom_dial" data-toggle="tooltip" data-placement="top" title="Tone"></div>
                 </div>
               </div>

               <!-- íconos y diales end -->

             </div>
           </div>

           <!-- channel control end -->

           <!-- SECUENCIADOR (#secuenciador) -->


           <div id="secuenciador" class="col-10 mx-0 my-1 my-lg-0 p-0 pr-lg-1">

             <div class="pl-0 py-4 pr-4 corners-r overflow-auto fondo-1-animal">
               <div id="stepIndicator" class="grid-size d-flex flex-row justify-content-around stepper">
                 <span id="step1" class="stepIndicator"></span>
                 <span id="step2" class="stepIndicator"></span>
                 <span id="step3" class="stepIndicator"></span>
                 <span id="step4" class="stepIndicator"></span>
                 <span id="step5" class="stepIndicator"></span>
                 <span id="step6" class="stepIndicator"></span>
                 <span id="step7" class="stepIndicator"></span>
                 <span id="step8" class="stepIndicator"></span>
                 <span id="step9" class="stepIndicator"></span>
                 <span id="step10" class="stepIndicator"></span>
                 <span id="step11" class="stepIndicator"></span>
                 <span id="step12" class="stepIndicator"></span>
                 <span id="step13" class="stepIndicator"></span>
                 <span id="step14" class="stepIndicator"></span>
                 <span id="step15" class="stepIndicator"></span>
                 <span id="step16" class="stepIndicator"></span>
               </div>
               <div id="seq-animal" class="grid-size">


               </div>
             </div>
           </div>

           <!-- secuenciador end -->

           <!-- REGISTRO COMPARTIR (#jam-ajustes) -->

           <div id="jam-ajustes" class="col-12 mt-1 py-4 px-3 d-flex justify-content-between fondo-1-animal corners1">

             <!-- COMBO botones -->
             <div id="combo-botones" class="mr-auto d-flex flex-row">




              <!--  Erase channel -->
              <!-- <div id="eraseCh1" class="mx-auto d-flex my-auto flex-lg-column help-item">
                <a href="#" id="boton" class="animal-icon jam-btn text-center">
                  <span translate="no">erase Ch1</span>
                </a>
                <div class="m-auto text-center">
                </div>
              </div>-->

              <!-- Settings -->
              <div id="settings" class="animal-icon mb-2 mr-1" data-toggle="tooltip" data-placement="top" title="Settings">
                <a href="#" id="boton" data-toggle="modal" data-target="#settingsModal" role="button">
                  <img src="GUI/svg/botones/boton_ajustes_b.svg" class="btn-icon">
                </a>
              </div>
             </div>

<div id="combo-botones2" class="mx-auto d-flex flex-row">
  <div id="jam-sesion" class="mx-auto d-flex help-item" data-toggle="popover"
    title="JAM SESSION" data-placement="bottom" data-content="Invite more music explorers to your session">

    <a href="#" id="boton" data-toggle="modal" data-target="#jamModal" role="button"
      class="animal-icon jam-btn text-center">
      <span translate="no">Jam</span>
    </a>
    <div class="m-auto text-center">
    </div>
  </div>
  <!-- Toggle all -->
  <div id="toggleAll" class="toggle-btn animal-btn d-flex align-items-center justify-content-center ml-1" data-toggle="tooltip" data-placement="top" title="Toggle">
  </div>
</div>



             <div id="combo-botones3" class="ml-auto d-flex flex-row">
               <!--  Erase all -->
             <div id="eraseAll" class="mx-1 erase-btn animal-btn d-flex align-items-center justify-content-center" data-toggle="tooltip" data-placement="top" title="Erase">
             </div>
             <!-- Restart -->
             <a href="https://mom-lab.xyz/"><div id="resetAll" class="reset-btn animal-btn d-flex align-items-center justify-content-center" data-toggle="tooltip" data-placement="top" title="Restart">
             </div></a>


               <!--
                 <a id="help-btn" class="mx-auto align-self-baseline help-icon text-center" role="button">
                     <img src="GUI/svg/botones/boton_ayuda_b.svg" class="btn-icon">
                 </a>
                 -->
             </div>
           </div>

           <!-- registro compartir end -->

         </div>
       </div>
     </div>

     <!-- main-down end -->

     <!-- CONTACT-bar -->

     <div class="row my-5">
       <div class="col p-2 destaque-animal text-white texto-chico">
         <a href="https://mom-lab.studio/" target="_blank" translate="no" class="text-white">[MoM]</a> UY 2024 /
         <a href="#" id="boton" data-toggle="modal" data-target="#creditsModal" role="button" class="text-white">Credits</a>
       </div>
     </div>

     <!-- contact-bar end -->


   </div>


 <!-- FOOTER -->

   <div id="footer" class="container-fluid py-5 bg-white">
     <div class="row py-md-5">
       <div class="col-12 col-lg-7 mx-auto my-0 px-5 pb-3">
         <img src="GUI\img\landing\BID2024-logos.png" class="img-fluid">
       </div>
     </div>
   </div>


 <!-- footer end -->


  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
    integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
    integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
    crossorigin="anonymous"></script>

  <script src='https://cdn.jsdelivr.net/npm/nexusui@2.0.13/dist/NexusUI.js'></script>

  <script src="GUI/scriptGUI.js"></script>

  <script src="GUI/svgDraw.js"></script>


  <script src="/socket.io/socket.io.js"></script>


  <script src="script/WzRecorder.js"></script>

  <script> //NET
    $(function () {

      var myChannel = [];//todos
      var socket = io(window.location.href);
      var newUrl;
      var roomID;
      var selectedChannels = [];
      var soloOn;
      var bpm = 90;
      var swing = 0;
      var mikit = $("#sonidos-kit-4")[0];
      mikit = $(mikit).find("button")[0];
      $(mikit).trigger("click");

      if (window.innerHeight > window.innerWidth) {
        $("#alerta").css("display", "block");
      } else {
        $("#alerta").css("display", "none");
      }

      //Query screen size to create grid
      //smallest devices bootstrap default  GRILLA w:330 h:380
      // Small devices (landscape phones, 576px and up) @media (min-width: 576px) { ... } GRILLA w:430 h:380
      // Medium devices (tablets, 768px and up)  @media (min-width: 768px) { ... }  GRILLA w:580 h:380
      // Large devices (desktops, 992px and up) @media (min-width: 992px) { ... }  GRILLA w:580 h:380
      // Extra large devices (large desktops, 1200px and up)  @media (min-width: 1200px) { ... } GRILLA w:690 h:380
      var sequencer;

      if ($(window).width() > 1200) {
        //rosa
        sequencer = new Nexus.Sequencer('#seq-animal', {
          'size': [930, 505],
          'mode': 'toggle',
          'rows': 8,
          'columns': 16
        });

      } else if (($(window).width() > 992)) {
        //negro-animal(chocolate)
        sequencer = new Nexus.Sequencer('#seq-animal', {
          'size': [775, 505],
          'mode': 'toggle',
          'rows': 8,
          'columns': 16
        });

      } else if (($(window).width() > 768)) {
        //aqua
        sequencer = new Nexus.Sequencer('#seq-animal', {
          'size': [580, 505],
          'mode': 'toggle',
          'rows': 8,
          'columns': 16
        });

      } else if (($(window).width() > 576)) {
        //mostaza
        sequencer = new Nexus.Sequencer('#seq-animal', {
          'size': [430, 505],
          'mode': 'toggle',
          'rows': 8,
          'columns': 16
        });

      } else {
        //verde fluo
        sequencer = new Nexus.Sequencer('#seq-animal', {
          'size': [290, 505],
          'mode': 'toggle',
          'rows': 8,
          'columns': 16
        });
      }

      sequencer.colorize("accent", "#00B9E5");
      //NEXUs
      /*  var sequencer = new Nexus.Sequencer('#seq-animal', {
          'size': [580, 380],
          'mode': 'toggle',
          'rows': 8,
          'columns': 16
        });*/

      ///

      // TONEJS
      var myShifter1, myShifter2, myShifter3, myShifter4, myShifter5, myShifter6, myShifter7, myShifter8;
      var sonidos;
      var misKits = [];
      var misLoops = [];
      var miKitElegido;
      var loopMano = new Tone.Player({ "url": "/audios/kit1-mano/loopx4.wav", "volume": -1 }).toMaster();
      misLoops.push(loopMano);
      var kitMano = [];
      kitMano.push(new Tone.Player({ "url": "/audios/kit1-mano/8-cerdo-mano.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitMano.push(new Tone.Player({ "url": "/audios/kit1-mano/7-loro-mano.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitMano.push(new Tone.Player({ "url": "/audios/kit1-mano/6-sapo-mano.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitMano.push(new Tone.Player({ "url": "/audios/kit1-mano/5-pato-mano.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitMano.push(new Tone.Player({ "url": "/audios/kit1-mano/4-mono-mano.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitMano.push(new Tone.Player({ "url": "/audios/kit1-mano/3-gato-mano.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitMano.push(new Tone.Player({ "url": "/audios/kit1-mano/2-oso-mano.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitMano.push(new Tone.Player({ "url": "/audios/kit1-mano/1-buho-mano.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      misKits.push(kitMano);


      var loopAnimal = new Tone.Player({ "url": "/audios/kit2-animal/loopx4.wav", "volume": -1 }).toMaster();
      misLoops.push(loopAnimal);
      var kitAnimal = [];
      kitAnimal.push(new Tone.Player({ "url": "/audios/kit2-animal/8-cerdo-animal.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitAnimal.push(new Tone.Player({ "url": "/audios/kit2-animal/7-loro-animal.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitAnimal.push(new Tone.Player({ "url": "/audios/kit2-animal/6-sapo-animal.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitAnimal.push(new Tone.Player({ "url": "/audios/kit2-animal/5-pato-animal.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitAnimal.push(new Tone.Player({ "url": "/audios/kit2-animal/4-mono-animal.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitAnimal.push(new Tone.Player({ "url": "/audios/kit2-animal/3-gato-animal.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitAnimal.push(new Tone.Player({ "url": "/audios/kit2-animal/2-oso-animal.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitAnimal.push(new Tone.Player({ "url": "/audios/kit2-animal/1-buho-animal.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      misKits.push(kitAnimal);

      var loopRap = new Tone.Player({ "url": "/audios/kit3-rap/loopx4.wav", "volume": -1 }).toMaster();
      misLoops.push(loopRap);
      var kitRap = [];
      kitRap.push(new Tone.Player({ "url": "/audios/kit3-rap/8-cerdo-rap.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitRap.push(new Tone.Player({ "url": "/audios/kit3-rap/7-loro-rap.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitRap.push(new Tone.Player({ "url": "/audios/kit3-rap/6-sapo-rap.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitRap.push(new Tone.Player({ "url": "/audios/kit3-rap/5-pato-rap.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitRap.push(new Tone.Player({ "url": "/audios/kit3-rap/4-mono-rap.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitRap.push(new Tone.Player({ "url": "/audios/kit3-rap/3-gato-rap.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitRap.push(new Tone.Player({ "url": "/audios/kit3-rap/2-oso-rap.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitRap.push(new Tone.Player({ "url": "/audios/kit3-rap/1-buho-rap.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      misKits.push(kitRap);

      var loopAnimalia = new Tone.Player({ "url": "/audios/kit4-amazonia/loopx4.wav", "volume": -1 }).toMaster();
      misLoops.push(loopAnimalia);
      var kitAnimalia = [];
      kitAnimalia.push(new Tone.Player({ "url": "/audios/kit4-amazonia/8-cerdo-amazonia.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitAnimalia.push(new Tone.Player({ "url": "/audios/kit4-amazonia/7-loro-amazonia.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitAnimalia.push(new Tone.Player({ "url": "/audios/kit4-amazonia/6-sapo-amazonia.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitAnimalia.push(new Tone.Player({ "url": "/audios/kit4-amazonia/5-pato-amazonia.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitAnimalia.push(new Tone.Player({ "url": "/audios/kit4-amazonia/4-mono-amazonia.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitAnimalia.push(new Tone.Player({ "url": "/audios/kit4-amazonia/3-gato-amazonia.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitAnimalia.push(new Tone.Player({ "url": "/audios/kit4-amazonia/2-oso-amazonia.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitAnimalia.push(new Tone.Player({ "url": "/audios/kit4-amazonia/1-buho-amazonia.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      misKits.push(kitAnimalia);

      var loopMagico = new Tone.Player({ "url": "/audios/kit5-magico/loopx4.wav", "volume": -1 }).toMaster();
      misLoops.push(loopMagico);
      var kitMagico = [];
      kitMagico.push(new Tone.Player({ "url": "/audios/kit5-magico/8-cerdo-magico.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitMagico.push(new Tone.Player({ "url": "/audios/kit5-magico/7-loro-magico.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitMagico.push(new Tone.Player({ "url": "/audios/kit5-magico/6-sapo-magico.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitMagico.push(new Tone.Player({ "url": "/audios/kit5-magico/5-pato-magico.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitMagico.push(new Tone.Player({ "url": "/audios/kit5-magico/4-mono-magico.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitMagico.push(new Tone.Player({ "url": "/audios/kit5-magico/3-gato-magico.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitMagico.push(new Tone.Player({ "url": "/audios/kit5-magico/2-oso-magico.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitMagico.push(new Tone.Player({ "url": "/audios/kit5-magico/1-buho-magico.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      misKits.push(kitMagico);

      var loopSafari = new Tone.Player({ "url": "/audios/kit6-safari/loopx4.wav", "volume": -1 }).toMaster();
      misLoops.push(loopSafari);
      var kitSafari = [];
      kitSafari.push(new Tone.Player({ "url": "/audios/kit6-safari/8-cerdo-safari.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitSafari.push(new Tone.Player({ "url": "/audios/kit6-safari/7-loro-safari.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitSafari.push(new Tone.Player({ "url": "/audios/kit6-safari/6-sapo-safari.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitSafari.push(new Tone.Player({ "url": "/audios/kit6-safari/5-pato-safari.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitSafari.push(new Tone.Player({ "url": "/audios/kit6-safari/4-mono-safari.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitSafari.push(new Tone.Player({ "url": "/audios/kit6-safari/3-gato-safari.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitSafari.push(new Tone.Player({ "url": "/audios/kit6-safari/2-oso-safari.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitSafari.push(new Tone.Player({ "url": "/audios/kit6-safari/1-buho-safari.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      misKits.push(kitSafari);

      var loopBanda = new Tone.Player({ "url": "/audios/kit7-banda/loopx4.wav", "volume": -1 }).toMaster();
      misLoops.push(loopBanda);
      var kitBanda = [];
      kitBanda.push(new Tone.Player({ "url": "/audios/kit7-banda/8-cerdo-banda.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitBanda.push(new Tone.Player({ "url": "/audios/kit7-banda/7-loro-banda.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitBanda.push(new Tone.Player({ "url": "/audios/kit7-banda/6-sapo-banda.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitBanda.push(new Tone.Player({ "url": "/audios/kit7-banda/5-pato-banda.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitBanda.push(new Tone.Player({ "url": "/audios/kit7-banda/4-mono-banda.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitBanda.push(new Tone.Player({ "url": "/audios/kit7-banda/3-gato-banda.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitBanda.push(new Tone.Player({ "url": "/audios/kit7-banda/2-oso-banda.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitBanda.push(new Tone.Player({ "url": "/audios/kit7-banda/1-buho-banda.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      misKits.push(kitBanda);

      var loopPumpum = new Tone.Player({ "url": "/audios/kit8-pumpum/loopx4.wav", "volume": -1 }).toMaster();
      misLoops.push(loopPumpum);
      var kitPumpum = [];
      kitPumpum.push(new Tone.Player({ "url": "/audios/kit8-pumpum/8-cerdo-pumpum.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitPumpum.push(new Tone.Player({ "url": "/audios/kit8-pumpum/7-loro-pumpum.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitPumpum.push(new Tone.Player({ "url": "/audios/kit8-pumpum/6-sapo-pumpum.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitPumpum.push(new Tone.Player({ "url": "/audios/kit8-pumpum/5-pato-pumpum.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitPumpum.push(new Tone.Player({ "url": "/audios/kit8-pumpum/4-mono-pumpum.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitPumpum.push(new Tone.Player({ "url": "/audios/kit8-pumpum/3-gato-pumpum.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitPumpum.push(new Tone.Player({ "url": "/audios/kit8-pumpum/2-oso-pumpum.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitPumpum.push(new Tone.Player({ "url": "/audios/kit8-pumpum/1-buho-pumpum.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      misKits.push(kitPumpum);

      var loopBata = new Tone.Player({ "url": "/audios/kit9-bata/loopx4.wav", "volume": -1 }).toMaster();
      misLoops.push(loopBata);
      var kitBata = [];
      kitBata.push(new Tone.Player({ "url": "/audios/kit9-bata/8-cerdo-bata.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitBata.push(new Tone.Player({ "url": "/audios/kit9-bata/7-loro-bata.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitBata.push(new Tone.Player({ "url": "/audios/kit9-bata/6-sapo-bata.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitBata.push(new Tone.Player({ "url": "/audios/kit9-bata/5-pato-bata.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitBata.push(new Tone.Player({ "url": "/audios/kit9-bata/4-mono-bata.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitBata.push(new Tone.Player({ "url": "/audios/kit9-bata/3-gato-bata.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitBata.push(new Tone.Player({ "url": "/audios/kit9-bata/2-oso-bata.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitBata.push(new Tone.Player({ "url": "/audios/kit9-bata/1-buho-bata.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      misKits.push(kitBata);


      var kitVocales = [];
      kitVocales.push(new Tone.Player({ "url": "/audios/kit10-vocales/8-a.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitVocales.push(new Tone.Player({ "url": "/audios/kit10-vocales/7-e.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitVocales.push(new Tone.Player({ "url": "/audios/kit10-vocales/6-i.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitVocales.push(new Tone.Player({ "url": "/audios/kit10-vocales/5-o.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitVocales.push(new Tone.Player({ "url": "/audios/kit10-vocales/4-u.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitVocales.push(new Tone.Player({ "url": "/audios/kit10-vocales/3-b.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitVocales.push(new Tone.Player({ "url": "/audios/kit10-vocales/2-m.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      kitVocales.push(new Tone.Player({ "url": "/audios/kit10-vocales/1-r.wav", "volume": -1, "fadeOut": "16n" }).toMaster());
      misKits.push(kitVocales);

      //var kit
      sonidos = kitAnimalia;
      //   var myShifter = [myShifter1, myShifter2, myShifter3, myShifter4, myShifter5, myShifter6, myShifter7, myShifter8];
      //the notes
      var scaleNotes = ["Cerdo", "Loro", "Pato", "Sapo", "Gato", "Mono", "Oso", "Buho"];

      //    for (i = 0; i < 8; i++) {
      //(sonidos.get(scaleNotes[(7 - myAnimalNumber)]).
      //      myShifter[i] = new Tone.PitchShift(0); //.toMaster();
      //      myShifter[i].windowSize = 0.03;
      //      sonidos.get(scaleNotes[i]).chain(myShifter[i], Tone.Master);
      //   }
      var stepNumber = 0;
      var loop = 0;
      var myKitNum = 4;

      Tone.Transport.bpm.value = bpm;
      Tone.Transport.swing = swing;
      Tone.Transport.swingSubdivision = "16n";



      var matrix = sequencer.matrix.pattern;
      //  io.connect);
      //esconde enlace
      $("#enlace").addClass("opacity-3");
      $("#enlace").css("pointer-events", "none");
      $("#okCanales").attr("disabled", true);

      socket.on('host', function (newroomID) {

        var currentUrl = window.location.href;
        var url = new URL(currentUrl);
        roomID = newroomID;
        url.searchParams.set("roomID", newroomID); // setting your param
        newUrl = url.href;
        let stateObj = { id: "100" };
        window.history.replaceState(stateObj, "roomID", newUrl);
        var seqInicial = [
        [true, false, false, false, false, false, false, false, false, false, false, false, false, false, false, false],
        [false, false, false, false, false, false, false, false, false, true, false, false, false, false, false, false],
        [false, false, false, false, false, false, false, false, false, false, false, false, true, false, false, false],
        [false, false, false, false, false, false, false, true, false, false, false, false, false, false, false, false],
        [false, false, false, false, false, false, false, false, false, false, false, false, false, false, false, true],
        [false, false, false, false, false, true, false, false, false, false, true, false, false, false, false, false],
        [false, false, true, false, false, false, false, false, false, false, false, false, false, false, false, false],
        [false, false, false, false, false, false, false, false, true, false, false, false, false, false, true, false]
        ];
        socket.emit('sequencer', sequencer.matrix.pattern);

        $(".disabled-overlay").addClass("d-none");
        myChannel = [1, 2, 3, 4, 5, 6, 7, 8];
        sequencer.matrix.set.all(seqInicial);
      //  $("#chat-animal").attr("style", "display: none !important");

      });


      socket.on('guest', function (pattern, michannel, unbpm, unkitnum) {
        myKitNum = unkitnum-1;
        sonidos = misKits[myKitNum];

        console.log("guest entered room kit" + myKitNum);
        $("#jam-sesion").addClass("d-none");
        $("#jam-sesion").addClass("ajeno");
        $("#settings").addClass("ajeno");
        $("#settings").addClass("d-none");
        sequencer.matrix.set.all(pattern);
        myChannel = michannel;
        setMyChannel();
        bpm = unbpm;
        Tone.Transport.bpm.value = bpm;
        //console.log("me llegó bpm de " + unbpm);
        //sacarbpm
        $("#decrement-bpm-btn").addClass("opacity-3");
        $("#decrement-bpm-btn").addClass("ajeno");
        $("#increment-bpm-btn").addClass("opacity-3");
        $("#increment-bpm-btn").addClass("ajeno");
        $("#chat-animal").attr("style", "");
      });




      // JAM SECTION
      $(".jam-btn").click(function () {
        if (Tone.Transport.state == "started") {
          $("#mute-btn").trigger("click");
        }
      })
      $(".channelsInvite").click(function () {
        var selectedCH = $(this)[0];
        if ($(selectedCH).attr("sel") == "false") {
          $(selectedCH).css("border-style", "solid");
          selectedChannels.push($(selectedCH).attr("channelNumber"));
          $(selectedCH).attr("sel", "true");
        } else {
          $(selectedCH).attr("sel", "false");
          var index = selectedChannels.indexOf($(selectedCH).attr("channelNumber"));
          if (index > -1) {
            selectedChannels.splice(index, 1);
          }

          $(selectedCH).css("border-style", "none");
        }
        if (selectedChannels.length > 0) {
          $("#okCanales").attr("disabled", false);
        } else {
          $("#okCanales").attr("disabled", true);
        }
      });

      $("#okCanales").click(function () {
        if (selectedChannels.length > 0) {
          myChannel = selectedChannels;
          setMyChannel();
          $("#sel-inst").addClass("opacity-3");
          $("#sel-inst").css("pointer-events", "none");
          $("#enlace").removeClass("opacity-3");
          $("#enlace").css("pointer-events", "");
          $("#linkText").val(window.location.origin + "?roomID=" + roomID);


          socket.emit('roomOpened', myChannel, myKitNum);
          console.log("emit open room kit" + myKitNum);




        }
      });

      // AUDIT sounds (jam window)?

      $(".instrument-preview").click(function (e) {
        e.stopPropagation();
        var myId = this.id.split("instrument-preview")[1];
        sonidos[myId - 1].start();

      });
      $(".instrument-preview, .kit-preview").hover(function () {
        this.src = "GUI/img/audio_over.png"
      },
        function () { this.src = "GUI/img/audio_trans.png" }

      );


      //copy link
      $(".input-group-append").click(function () {
        /* Get the text field */
        var copyText = document.getElementById("linkText");

        /* Select the text field */
        copyText.select();
        copyText.setSelectionRange(0, 99999); /*For mobile devices*/

        /* Copy the text inside the text field */
        document.execCommand("copy");

      });


      //END JAM SECTION



      function setMyChannel() {
        // $(".channelGroup").addClass("opacity-2");
        //   $(".channelGroup").addClass("ajeno");
        $(".disabled-overlay").addClass("d-block");

        if (myChannel.length > 0) {
          myChannel.forEach(channel => {
            $("#channelGroup" + channel).removeClass("opacity-2");
            $("#channelGroup" + channel).removeClass("ajeno");
            var myInst = $(".instrumento" + channel)[0];

            $(myInst).find(".disabled-overlay").removeClass("d-block");
            $(myInst).find(".disabled-overlay").addClass("d-none");
          });

          var cuadrados = $("rect");     //((v.row * 16)) + (v.column)];

          for (i = 0; i < cuadrados.length; i++) {
            var mio = false;
            myChannel.forEach(function (channel) {
              if (Math.floor(i / 16) == channel - 1) {
                mio = true;
              }
            });
            if (!mio) {
              var miRect = $("rect")[i];
              $(miRect).css("pointer-events", "none");
            }
          }
          /*
          sequencer.matrix.ui.cells.forEach(function (cell) {
            $(cell).css("pointer-events", "none");
          });*/

        }


        $(".ajeno").click(function (e) {
          //   e.preventDefault();
          //console.log("entró a prevent");
        });


      }

      sequencer.on('change', function (v) {
        myChannel.forEach(function (micha) {
          if (v.row == micha - 1) {
            socket.emit('toggleStep', v);
            //console.log("emito change");
          }
        });
      });

      socket.on('toggleStep', function (miStep) {
        //console.log("llego " + miStep);
        sequencer.matrix.set.cell(miStep.column, miStep.row, miStep.state);
        // sequencer.colorize("accent","#ff0000");

      });

      // EMIT bpm

      socket.on("bpm", function (unbpm) {
        bpm = unbpm;
        Tone.Transport.bpm.value = bpm;
        $("#bpmNumber").html(bpm);
      });

      function emitBpm(bpm) {
        Tone.Transport.bpm.value = bpm;
        socket.emit('bpm', bpm);
      }

      $("#decrement-bpm-btn").click(function () {
        bpm--;
        $("#bpmNumber").html(bpm);
        emitBpm(bpm);
      });

      $("#increment-bpm-btn").click(function () {
        bpm++;
        $("#bpmNumber").html(bpm);
        emitBpm(bpm);
      });


      // EMIT swing

      socket.on("swing", function (unswing) {
        swing = unswing;

        Tone.Transport.swing = swing / 100;
        $("#swingNumber").html(swing);
      });

      function emitSwing(swing) {
        Tone.Transport.swing = swing / 100;
        socket.emit('swing', swing);
      }

      $("#decrement-swing-btn").click(function () {
        if (swing > 0) {
          swing = swing - 5;
          $("#swingNumber").html(swing);
          emitSwing(swing);
        }
      });

      $("#increment-swing-btn").click(function () {
        if (swing < 55) {
          swing = swing + 5;
          $("#swingNumber").html(swing);
          emitSwing(swing);
        }
      });



      // SOLO por canal
      // arrays CASILLEROS del sequencer
      var myArray = [
      [112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127],
      [96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111],
      [80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95],
      [64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79],
      [48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63],
      [32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47],
      [16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31],
      [0 ,1 ,2 , 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15] ];

      var myChannelAnimalIcon = $("#animalChannel1")[0];
      var miSolo = -1;

      $(".soloButton").click(function () {
        $(".instMobile").addClass("d-none");
        $(".instMobile").removeClass("d-block");

        var myId = this.id;
        var myAnimalNumber = myId.split("channel-solo")[1];
        myAnimalNumber--;
        $($(".instMobile")[myAnimalNumber]).addClass("d-block");
        $(".soloButton").removeClass("chn-solo");

        if (miSolo == (7 - myAnimalNumber)) {
          // quita estilo a BOTON solo
          $(this).removeClass("chn-solo");
          miSolo = -1;
          // quita estilo a casilleros del sequencer
          $('#seq-animal span').removeClass( "chn-solo" );

        } else {
          // aplica estilo a BOTON solo
          $(this).addClass("chn-solo");
          miSolo = (7 - myAnimalNumber);
          // quita y aplica estilo a casilleros del sequencer
          $('#seq-animal span').removeClass( "chn-solo" );
          $('#seq-animal span').each(function() {
            if ($.inArray($(this).index(), myArray[myAnimalNumber]) < 0)
              return;
            $(this).addClass( "chn-solo" );
          });
        }
      });


      // MUTE por canal
      $(".channel-mute").click(function () {
        var myId = this.id;
        var myAnimalNumber = myId.split("channel-mute")[1];
        myAnimalNumber--;
        if ($(this).hasClass('chn-muted')) {
          sonidos[myAnimalNumber].mute = false;
          $(this).removeClass("chn-muted");
        } else {
          sonidos[myAnimalNumber].mute = true;
          $(this).addClass("chn-muted");
        }
      });

      /*
      myAnimalNumber--;
      if (!(sonidos.get(scaleNotes[(7 - myAnimalNumber)]).mute)) {
         $(this).addClass("activado");
        for (i = 0; i < 8; i++) {
          sonidos.get(scaleNotes[i]).mute = true;
          //console.log("es el animal numero"+ i)
          //console.log(scaleNotes[i]);
          //console.log("quedó muteado " +sonidos.get(scaleNotes[i]).mute);
        }
        sonidos.get(scaleNotes[(7 - myAnimalNumber)]).mute = false;
        //console.log(scaleNotes[(7 - myAnimalNumber)]);

      } else {
        $(this).removeClass("activado");
        for (i = 0; i < 8; i++) {
          //console.log(scaleNotes[i]);
          sonidos.get(scaleNotes[i]).mute = false;
          //console.log("es el animal numero"+ i)
          //console.log(scaleNotes[i]);
          //console.log("quedó muteado " +sonidos.get(scaleNotes[i]).mute);
        }

    }


    });*/

    // AUDIT  (channel icon)
    $(".sound-preview").click(function (e) {
      e.stopPropagation();
      var myId = this.id.split("icono-ch")[1];
      sonidos[myId - 1].start();
    });
    // AUDIT (channel number) event keydown
    document.addEventListener('keydown', event => {
      // sin cuantizar
      if (event.key === '1') {
        sonidos[0].start();
      } else if (event.key === '2') {
        sonidos[1].start();
      } else if (event.key === '3') {
        sonidos[2].start();
      } else if (event.key === '4') {
        sonidos[3].start();
      } else if (event.key === '5') {
        sonidos[4].start();
      } else if (event.key === '6') {
        sonidos[5].start();
      } else if (event.key === '7') {
        sonidos[6].start();
      } else if (event.key === '8') {
        sonidos[7].start();
      }
    });

    // AUTOPLAY
    let autoplay=0;
    sequencer.on('step', function (v) {
      autoplay += 1;
      if (autoplay === 16 || autoplay === 48 ){

        //playSequencer();
        //playSequencer();
        console.log("AUTOSTART");

      } else if (autoplay === 80) {
        autoplay=0;
      }
      console.log("Autoplay= " + autoplay);
    });


    // STEP INDICATOR
    let stepInd=0;
    sequencer.on('step', function (v) {
      stepInd += 1;
      if (stepInd === 1){
        $('.stepIndicator').removeClass('stepIndicator-step');
        $('#step1').addClass('stepIndicator-step');
      } else if (stepInd === 2) {
        $('.stepIndicator').removeClass('stepIndicator-step');
        $('#step2').addClass('stepIndicator-step');
      } else if (stepInd === 3) {
        $('.stepIndicator').removeClass('stepIndicator-step');
        $('#step3').addClass('stepIndicator-step');
      } else if (stepInd === 4) {
        $('.stepIndicator').removeClass('stepIndicator-step');
        $('#step4').addClass('stepIndicator-step');
      } else if (stepInd === 5) {
        $('.stepIndicator').removeClass('stepIndicator-step');
        $('#step5').addClass('stepIndicator-step');
      } else if (stepInd === 6) {
        $('.stepIndicator').removeClass('stepIndicator-step');
        $('#step6').addClass('stepIndicator-step');
      } else if (stepInd === 7) {
        $('.stepIndicator').removeClass('stepIndicator-step');
        $('#step7').addClass('stepIndicator-step');
      } else if (stepInd === 8) {
        $('.stepIndicator').removeClass('stepIndicator-step');
        $('#step8').addClass('stepIndicator-step');
      } else if (stepInd === 9) {
        $('.stepIndicator').removeClass('stepIndicator-step');
        $('#step9').addClass('stepIndicator-step');
      } else if (stepInd === 10) {
        $('.stepIndicator').removeClass('stepIndicator-step');
        $('#step10').addClass('stepIndicator-step');
      } else if (stepInd === 11) {
        $('.stepIndicator').removeClass('stepIndicator-step');
        $('#step11').addClass('stepIndicator-step');
      } else if (stepInd === 12) {
        $('.stepIndicator').removeClass('stepIndicator-step');
        $('#step12').addClass('stepIndicator-step');
      } else if (stepInd === 13) {
        $('.stepIndicator').removeClass('stepIndicator-step');
        $('#step13').addClass('stepIndicator-step');
      } else if (stepInd === 14) {
        $('.stepIndicator').removeClass('stepIndicator-step');
        $('#step14').addClass('stepIndicator-step');
      } else if (stepInd === 15) {
        $('.stepIndicator').removeClass('stepIndicator-step');
        $('#step15').addClass('stepIndicator-step');
      } else {
        $('.stepIndicator').removeClass('stepIndicator-step');
        $('#step16').addClass('stepIndicator-step');
        stepInd=0;
      }
    });

    // METRONOMO
    let metro=0;
    sequencer.on('step', function (v) {

        var count= document.getElementById("metronome");
        //count.innerHTML=++metro;
        metro +=1
        if (metro === 16){
          metro=0;
        } else if (metro === 13) {
          $('#metronome').addClass('metronome-step');
        } else if (metro === 9) {
          $('#metronome').addClass('metronome-step');
        } else if (metro === 5) {
          $('#metronome').addClass('metronome-step');
        } else if (metro === 1) {
          $('#metronome').addClass('metronome-accent');
        } else {
          $('#metronome').removeClass('metronome-accent');
          $('#metronome').removeClass('metronome-step');
        }

    });

    // CHANGE sound LENGHT

          $("#lenght1n").click(function () {

            for (i = 0; i < 8; i++) {
              sonidos[i].fadeOut = "1n";
            }
          });
          $("#lenght4n").click(function () {

            for (i = 0; i < 8; i++) {
              sonidos[i].fadeOut = "4n";
            }
          });
          $("#lenght8n").click(function () {

            for (i = 0; i < 8; i++) {
              sonidos[i].fadeOut = "8n";
            }
          });
          $("#lenght16n").click(function () {

            for (i = 0; i < 8; i++) {
              sonidos[i].fadeOut = "16n";
            }
          });

      /////REC and SAVE MUSIC
      var isRecording;
      const actx = Tone.context;
      const dest = actx.createMediaStreamDestination();
      let recorder = null;
      var chunks = [];

      $("#rec-btn").click(function () {

        var oldText = $("#rec-btn").find("span").text();
        var newText = $("#rec-btn").find("span").data('text');
        $("#rec-btn").find("span").text(newText).data('text',oldText);

        if (isRecording) {
          recorder.stop();
          return;
        }
        else {
          try {
            recorder = new MediaRecorder(dest.stream);
          } catch (err) {
            return err.name;     /* return the error name */
          }
          sonidos.forEach(sonido => {
            sonido.connect(dest);
          });

          isRecording = true;
          chunks = [];
          $(this).toggleClass('rec-btn-activo');
          recorder.start();

          // dest = actx.createMediaStreamDestination();


          recorder.ondataavailable = evt => chunks.push(evt.data);

          recorder.onstop = evt => {
            let blob = new Blob(chunks, { type: 'audio/ogg; codecs=opus' });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = 'sesion ANIMAL.ogg';
            a.target = "_blank"
            a.click();
            $(this).toggleClass('rec-btn-activo');
            isRecording = false;
          };
        }

      });
      ///END REC AND SAVE MUSIC

      // PLAY sequencer



      function playSequencer() {
        if (loop === 0) {
          var matrix = sequencer.matrix.pattern;
          loop = new Tone.Sequence(function (time) {

            for (var i = 7; i >= 0; i--) {

              if (matrix[i][stepNumber] && (miSolo == -1 || miSolo == i)) {
                if (i != 1) {
                  sonidos[i].start(time, 0, "16n", 0, 1);
                } else {
                  sonidos[i].start();
                }

              }

            }
            sequencer.next();
            stepNumber++;
            stepNumber = stepNumber % 16;


          }, scaleNotes, "16n");
          loop.start();

          loop.loop = true;
        }
        if (Tone.Transport.state == "started") {
          Tone.Transport.stop();
          // sequencer.stop();
        } else {
          //   sequencer.start()
          //  sequencer.interval.ms(166);
          Tone.Transport.start();
        }
      };



      $("#mute-btn").click(function () {
          playSequencer();
          var oldText = $("#mute-btn").find("span").text();
          var newText = $("#mute-btn").find("span").data('text');
          $("#mute-btn").find("span").text(newText).data('text',oldText);

          $(this).toggleClass('mute-btn-activo');
      });

      // TOGGLE ALL
      $("#toggleAll").click(function () {
        sequencer.matrix.toggle.all();
        //playSequencer();
        // console.log("toggle all")
      });

      // SPACE BAR event = keyup or keydown

      // prevenir scroll
      window.addEventListener('keydown', function(e) {
        if(e.keyCode == 32 && e.target == document.body) {
          e.preventDefault();
        }
      });
      // play stop
      document.addEventListener('keydown', event => {
        if (event.code === 'Space') {
          playSequencer();
        }
      });

      // ERASE ALL
      $("#eraseAll").click(function () {
        sequencer.matrix.populate.all( [0,0] );
        //playSequencer();
        // console.log("erase all")
      });
      //$("#eraseCh1").click(function () {
        //sequencer.matrix.populate.row( 0, [0,0] )
      //  playSequencer();
        // console.log("erase all")
      //});

      // CHANGE PITCH
      function changePitch(myAnimal, value) {
        //console.log("entro a change pitch");
        //console.log(myAnimal);
        var myAnimalNumber = myAnimal.split("dial-ins")[1];
        //  myShifter[8 - myAnimalNumber].pitch = value;
        sonidos[8 - myAnimalNumber].playbackRate = value;


        console.log("changed playback rate animal " + (8 - myAnimalNumber) + "to value " + value);
        //sonidos.get(scaleNotes[8 - myAnimalNumber]).volume.value = value;
      }

      // CHANGE VOLUME
      function changeVolume(myAnimal, value) {
        //console.log("entro a change volume");
        //console.log(myAnimal);
        var myAnimalNumber = myAnimal.split("dial-ch")[1];
        sonidos[8 - myAnimalNumber].volume.value = value;
      }


      socket.on('pitchChange', function (myAnimal, value) {
        changePitch(myAnimal, value);
      });


      socket.on('volumeChanged', function (myAnimal, value) {
        changeVolume(myAnimal, value);
      });

      dialins.forEach((dialin) => {
        dialin.on('change', function (v) {
          //console.log("encontró el dial");
          //console.log(this);
          //console.log(v);
          var id = this.parent.id
          socket.emit('pitchChange', id, v);
          changePitch(id, v);
        })
      })

      dialchs.forEach((dialch) => {
        dialch.on('change', function (v) {
          //console.log("encontró el dial");
          //console.log(this);
          //console.log(v);
          var id = this.parent.id
          socket.emit('volumeChanged', id, v);
          changeVolume(id, v);
        })
      })



      //VISIBILITY PAUSE
      // Set the name of the hidden property and the change event for visibility
      var hidden, visibilityChange;
      if (typeof document.hidden !== "undefined") { // Opera 12.10 and Firefox 18 and later support
        hidden = "hidden";
        visibilityChange = "visibilitychange";
      } else if (typeof document.msHidden !== "undefined") {
        hidden = "msHidden";
        visibilityChange = "msvisibilitychange";
      } else if (typeof document.webkitHidden !== "undefined") {
        hidden = "webkitHidden";
        visibilityChange = "webkitvisibilitychange";
      }

      function handleVisibilityChange() {
        if (document[hidden]) {
          Tone.Transport.stop();
        }
      }


      // Warn if the browser doesn't support addEventListener or the Page Visibility API
      if (typeof document.addEventListener === "undefined" || hidden === undefined) {
        //console.log("This demo requires a browser, such as Google Chrome or Firefox, that supports the Page Visibility API.");
      } else {
        // Handle page visibility change
        document.addEventListener(visibilityChange, handleVisibilityChange, false);
      }
      // END  VISIBILITY PAUSE

      window.addEventListener("orientationchange", function () {
        //console.log("the orientation of the device is now " + screen.orientation.angle);
        if (window.innerHeight > window.innerWidth) {
          $("#alerta").css("display", "block");
        } else {
          $("#alerta").css("display", "none");
        }
      });


            // Modal SETTINGS

      var visitado;

      $("#settings").click(function () {
      //  if (Tone.Transport.state == "started") {
      //    $("#mute-btn").trigger("click");
      //  }

        if ( visitado != 1){
          var currKit = "kit"+(myKitNum);
          visitado = 1;
        } else {
          var currKit = "kit"+(myKitNum+1);
        }

        $("#settingsModal").find( "button" ).removeClass('cKit');
        $('#' + currKit).addClass('cKit');

	    });


      $(".kits").click(function () {

        $("#settingsModal").find( "button" ).removeClass('cKit');
        $(this).addClass('cKit');
      });




      //kits

      socket.on('changeKit', function (unkit) {
        myKitNum = unkit;
        sonidos = misKits[myKitNum];
        console.log("kit " + unkit)
      });

      $(".kits").click(function () {
        var myKitNumtemp = this.id;
        myKitNumtemp = myKitNumtemp.split("kit")[1];
        myKitNum = myKitNumtemp-1;
        sonidos = misKits[myKitNum];
        socket.emit("changeKit", myKitNum);
        //kits miKitNum;
      });


      $(".kit-preview").click(function () {
        var myKitNumpre = this.id;
        myKitNumpre = myKitNumpre.split("kit-preview")[1];
        misLoops.forEach(loop => {
          loop.stop();
        });
        misLoops[myKitNumpre-1].start();
        //sonidos = misKits[myKitNum];
      });

    });

    // BIG function end

  </script>

  <script>
    $(document).ready(function () {
      // reset svg each time
      $("#svg1").attr("height", "0");
      $("#svg1").attr("width", "0");
      connectAll();
    });

    $(window).resize(function () {
      // reset svg each time
      $("#svg1").attr("height", "0");
      $("#svg1").attr("width", "0");
      connectAll();
    });


    //
    $(document).ready(function () {

      $(window).on('focus', function () {
        console.log('The window has focus');
      });

      $(window).on('blur', function () {
        if (Tone.Transport.state == "started"){
          var oldText = $("#mute-btn").find("span").text();
          var newText = $("#mute-btn").find("span").data('text');
          $("#mute-btn").find("span").text(newText).data('text',oldText);

          $("#mute-btn").removeClass('mute-btn-activo');
        }
        console.log('The window lost focus');
      });
    });

  </script>

<!-- MODAL inicial -->
  <!--  <script type="text/javascript">
      $(document).ready(function () {
        $('#playModal').modal('show');
      });
    </script> -->

<script type="text/javascript">
  $(document).ready(function () {
    $('[data-toggle="tooltip"]').tooltip();
    $('[data-toggle="popover"]').popover();


    $('.popover:eq(0)').addClass('play-start-item corners-2');
  });


  $('#creditos').on('click', function() {
    $('#creditos').popover('toggle');
    $('.popover:eq(0)').addClass('play-start-item corners-2');
  });

  $('#help-btn').on('click', function() {
      $('#mute-btn').popover('toggle');
      $('#instrumentos').popover('toggle');
      $('#sel-inst-help').popover('toggle');
      // $('#chat-help').popover('toggle');
      $('#jam-sesion').popover('toggle');
      $('#channelGroup8').popover('toggle');
      $('#animalChannel1').popover('toggle');


    $('.popover:eq(0)').addClass('instrumentos-help-item corners-2');
    $('.popover:eq(1)').addClass('sel-ins-help-item corners-2');
    $('.popover:eq(2)').addClass('chat-help-item corners-2');
    $('.popover:eq(3)').addClass('jam-sesion-help-item corners-2');
    $('.popover:eq(4)').addClass('canal-help-item corners-2');
    $('.popover:eq(5)').addClass('solo-help-item corners-2');


  });

  $(document).on('click', function(e) {
    $('.data-item').popover('dispose');
    var pvr = $("#help-btn");
    if (!$(e.target).closest(pvr).length) {
          $('.help-item').popover('dispose');
          $('.start-item').popover('dispose');
    }
  });



</script>

</body>

</html>
